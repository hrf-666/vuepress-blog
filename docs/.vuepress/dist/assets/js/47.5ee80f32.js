(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{637:function(t,s,e){t.exports=e.p+"assets/img/15.sentinel选举.54c2620f.png"},638:function(t,s,e){t.exports=e.p+"assets/img/16.旧master配置文件重写.15d68bdb.jpg"},639:function(t,s,e){t.exports=e.p+"assets/img/17.slave升master配置文件重写.88371ebe.jpg"},640:function(t,s,e){t.exports=e.p+"assets/img/18.多master监控.4de78597.jpg"},799:function(t,s,e){"use strict";e.r(s);var a=e(5),r=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"主节点异常情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主节点异常情况"}},[t._v("#")]),t._v(" 主节点异常情况")]),t._v(" "),s("h3",{attrs:{id:"原有的master挂了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原有的master挂了"}},[t._v("#")]),t._v(" 原有的master挂了")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("我们自己手动关闭6379服务器，模拟master挂了")])]),t._v(" "),s("li",[s("p",[t._v("问题思考")]),t._v(" "),s("ol",[s("li",[t._v("两台从机数据是否OK")]),t._v(" "),s("li",[t._v("是否会从剩下的2台机器上选出新的master")]),t._v(" "),s("li",[t._v("之前down机的master机器重启回来，谁将会是新老大？会不会双master冲突")])])]),t._v(" "),s("li",[s("p",[t._v("揭晓答案")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("两台从机数据OK")]),t._v(" "),s("p",[t._v("![](images/14.Broken Pipe.png)")])]),t._v(" "),s("li",[s("p",[t._v("会投票选出新的master主机")]),t._v(" "),s("p",[s("img",{attrs:{src:e(637),alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("谁是master，限本次案例")]),t._v(" "),s("p",[t._v("本案例中6381被选举为新的master，上位成功")]),t._v(" "),s("p",[t._v("重启6379之后，它会从原来的master降级为slave")]),t._v(" "),s("p",[t._v("6380还是slave，只不过是换了一个新老大6381(从跟随6379变成跟随6381)")])])])])]),t._v(" "),s("h3",{attrs:{id:"对比配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对比配置文件"}},[t._v("#")]),t._v(" 对比配置文件")]),t._v(" "),s("p",[t._v("老master的redis6379.conf文件")]),t._v(" "),s("p",[s("img",{attrs:{src:e(638),alt:""}})]),t._v(" "),s("p",[t._v("新master的redis6381.conf文件")]),t._v(" "),s("p",[s("img",{attrs:{src:e(639),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"结论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),s("p",[t._v("$\\textcolor{red}{文件的内容，在运行期间会被sentinel动态进行更改}$")]),t._v(" "),s("p",[t._v("$\\textcolor{red}{Master-Slave切换后，master_redis.conf、slave_redis.conf、sentinel.conf的内容都会发生改\\变，即master_redis.conf中会多一行slaveof的配置，而升级为master的主机会去掉原来的slaveof配置，\\sentinel.conf的监控目标会随之调换}$")]),t._v(" "),s("h3",{attrs:{id:"其他备注"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他备注"}},[t._v("#")]),t._v(" 其他备注")]),t._v(" "),s("p",[t._v("生产上都是不同机房不同服务器，很少出现3个哨兵全部挂掉的情况")]),t._v(" "),s("p",[t._v("可以同时金童多个master，一行一个")]),t._v(" "),s("p",[s("img",{attrs:{src:e(640),alt:""}})])])}),[],!1,null,null,null);s.default=r.exports}}]);